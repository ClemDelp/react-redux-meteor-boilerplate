{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"twitter","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Twitter"}]},{"source":"body-parser","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"bodyParser"}]},{"source":"../imports/api/Trend.js","imported":["Trend"],"specifiers":[{"kind":"named","imported":"Trend","local":"Trend"}]},{"source":"../imports/api/Woeid.js","imported":["Woeid"],"specifiers":[{"kind":"named","imported":"Woeid","local":"Woeid"}]},{"source":"./constants.js","imported":["TWITTER_CONSUMER_KEY","TWITTER_CONSUMER_SECRET","TWITTER_ACCESS_TOKEN_KEY","TWITTER_ACCESS_TOKEN_SECRET"],"specifiers":[{"kind":"named","imported":"TWITTER_CONSUMER_KEY","local":"TWITTER_CONSUMER_KEY"},{"kind":"named","imported":"TWITTER_CONSUMER_SECRET","local":"TWITTER_CONSUMER_SECRET"},{"kind":"named","imported":"TWITTER_ACCESS_TOKEN_KEY","local":"TWITTER_ACCESS_TOKEN_KEY"},{"kind":"named","imported":"TWITTER_ACCESS_TOKEN_SECRET","local":"TWITTER_ACCESS_TOKEN_SECRET"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/server/main.js","filenameRelative":"/server/main.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/server/main.js.map","sourceFileName":"/server/main.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"main"},"ignored":false,"code":"var Meteor;module.import('meteor/meteor',{\"Meteor\":function(v){Meteor=v}});var Twitter;module.import('twitter',{\"default\":function(v){Twitter=v}});var bodyParser;module.import('body-parser',{\"default\":function(v){bodyParser=v}});var Trend;module.import('../imports/api/Trend.js',{\"Trend\":function(v){Trend=v}});var Woeid;module.import('../imports/api/Woeid.js',{\"Woeid\":function(v){Woeid=v}});var TWITTER_CONSUMER_KEY,TWITTER_CONSUMER_SECRET,TWITTER_ACCESS_TOKEN_KEY,TWITTER_ACCESS_TOKEN_SECRET;module.import('./constants.js',{\"TWITTER_CONSUMER_KEY\":function(v){TWITTER_CONSUMER_KEY=v},\"TWITTER_CONSUMER_SECRET\":function(v){TWITTER_CONSUMER_SECRET=v},\"TWITTER_ACCESS_TOKEN_KEY\":function(v){TWITTER_ACCESS_TOKEN_KEY=v},\"TWITTER_ACCESS_TOKEN_SECRET\":function(v){TWITTER_ACCESS_TOKEN_SECRET=v}});\n\n\n\n\nvar Fiber = require('fibers');\n\n\n\nif (Meteor.isServer) {\n\tMeteor.startup(function () {\n\t\t// code to run on server at startup\n\t\tvar client = new Twitter({\n\t\t\tconsumer_key: TWITTER_CONSUMER_KEY,\n\t\t\tconsumer_secret: TWITTER_CONSUMER_SECRET,\n\t\t\taccess_token_key: TWITTER_ACCESS_TOKEN_KEY,\n\t\t\taccess_token_secret: TWITTER_ACCESS_TOKEN_SECRET\n\t\t});\n\n\t\tapp = Express();\n\t\tapp.use(bodyParser.json()); // to support JSON-encoded bodies\n\t\tapp.use(bodyParser.urlencoded({ // to support URL-encoded bodies\n\t\t\textended: true\n\t\t}));\n\n\t\t// TO TEST\n\t\t// const hastag = 'Usain Bolt'\n\t\t// const twitterStream = client.stream('statuses/filter', {track: String(hastag)});\n\t\t// let i = 0\n\t\t// twitterStream.on('data', function(tweet) {\n\t\t//   \t// Send a message to all connected sessions (Client & server)\n\t\t//   \tif (i%10 === 0) {\n\t\t//   \t\tconsole.log('tweet --> ', tweet.id_str)\n\t\t// \t\tStreamy.broadcast('hello', tweet);\t\n\t\t//   \t}\n\t\t// \ti++\n\t\t// });\n\t\t// -----\n\n\t\tvar timeCondition = function timeCondition(lastDatetime, cbYes, cbNo) {\n\t\t\tvar last = new Date(lastDatetime);\n\t\t\tvar now = new Date();\n\t\t\tconsole.log(last, now);\n\t\t\tvar timeDiff = Math.abs(now.getTime() - last.getTime());\n\t\t\tvar diffSeconds = Math.ceil(timeDiff / 1000);\n\t\t\tconsole.log('diff in seconds: ', diffSeconds);\n\t\t\t// CHECK 15 MINUTES INTERVAL\n\t\t\tif (diffSeconds > 15 * 60) {\n\t\t\t\tconsole.log('more than 15 minutes: request twitter...');\n\t\t\t\tcbYes();\n\t\t\t} else {\n\t\t\t\tconsole.log('less than 15 minutes: send last saved woeid...');\n\t\t\t\tcbNo();\n\t\t\t}\n\t\t};\n\n\t\tapp.get('/trends/available', function (req, res) {\n\t\t\tvar woeid = Woeid.findOne({}, { sort: { datetime: -1, limit: 1 } });\n\t\t\tvar datetime = 0;\n\t\t\tif (woeid && woeid.datetime) datetime = woeid.datetime;\n\t\t\ttimeCondition(datetime, function () {\n\t\t\t\tclient.get('trends/available', function (error, tweets, response) {\n\t\t\t\t\tif (error) throw error;\n\t\t\t\t\tif (response) {\n\t\t\t\t\t\t// INSERT IN DB\n\t\t\t\t\t\tFiber(function () {\n\t\t\t\t\t\t\tWoeid.insert({\n\t\t\t\t\t\t\t\tdatetime: new Date(),\n\t\t\t\t\t\t\t\tbody: response.body\n\t\t\t\t\t\t\t}, function (error, response) {\n\t\t\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t\t\tconsole.log('new woeid in db ', Woeid.find().count());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}).run();\n\t\t\t\t\t\tres.json({ data: response.body });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, function () {\n\t\t\t\tres.json({ data: woeid.body });\n\t\t\t});\n\t\t});\n\n\t\tapp.post('/trends', function (req, res) {\n\t\t\tvar woeid = req.body.woeid;\n\t\t\tif (woeid) {\n\t\t\t\tFiber(function () {\n\t\t\t\t\tconsole.log(woeid);\n\t\t\t\t\tvar trend = Trend.findOne({ woeid: woeid }, { sort: { datetime: -1, limit: 1 } });\n\t\t\t\t\tvar datetime = 0;\n\t\t\t\t\tif (trend && trend.datetime) datetime = trend.datetime;\n\t\t\t\t\ttimeCondition(datetime, function () {\n\t\t\t\t\t\tclient.get('trends/place', { id: woeid }, function (error, tweets, response) {\n\t\t\t\t\t\t\tif (error) throw error;\n\t\t\t\t\t\t\tif (response) {\n\t\t\t\t\t\t\t\t// INSERT IN DB\n\t\t\t\t\t\t\t\tFiber(function () {\n\t\t\t\t\t\t\t\t\tTrend.insert({\n\t\t\t\t\t\t\t\t\t\twoeid: woeid,\n\t\t\t\t\t\t\t\t\t\tdatetime: new Date(),\n\t\t\t\t\t\t\t\t\t\tbody: response.body\n\t\t\t\t\t\t\t\t\t}, function (error, response) {\n\t\t\t\t\t\t\t\t\t\tconsole.log(response);\n\t\t\t\t\t\t\t\t\t\tconsole.log('new trend in db ', Trend.find().count());\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}).run();\n\t\t\t\t\t\t\t\tres.json({ data: response.body });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}, function () {\n\t\t\t\t\t\tres.json({ data: woeid.body });\n\t\t\t\t\t});\n\t\t\t\t}).run();\n\t\t\t} else {\n\t\t\t\tres.json({ data: 'error required a valid woeid' });\n\t\t\t}\n\t\t});\n\n\t\tapp.post('/tweets', function (req, res) {\n\t\t\tvar hastag = req.body.hastag;\n\t\t\tif (hastag) {\n\t\t\t\t(function () {\n\t\t\t\t\tconsole.log(\"hastag: \", hastag);\n\t\t\t\t\t// const hastag = 'Usain Bolt'\n\t\t\t\t\tvar twitterStream = client.stream('statuses/filter', { track: String(hastag) });\n\t\t\t\t\tvar i = 0;\n\t\t\t\t\ttwitterStream.on('data', function (tweet) {\n\t\t\t\t\t\t// Send a message to all connected sessions (Client & server)\n\t\t\t\t\t\tif (i % 10 === 0) {\n\t\t\t\t\t\t\tconsole.log('tweet --> ', tweet.id_str);\n\t\t\t\t\t\t\tStreamy.broadcast('hello', tweet);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++;\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\t});\n}","ast":null,"map":{"version":3,"sources":["/server/main.js"],"names":[],"mappings":"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","file":"/server/main.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor'\nimport Twitter from 'twitter'\nimport bodyParser from 'body-parser'\nimport { Trend } from '../imports/api/Trend.js'\nimport { Woeid } from '../imports/api/Woeid.js'\nvar Fiber = require('fibers')\n\nimport {\n\tTWITTER_CONSUMER_KEY, \n\tTWITTER_CONSUMER_SECRET, \n\tTWITTER_ACCESS_TOKEN_KEY, \n\tTWITTER_ACCESS_TOKEN_SECRET\n} from './constants.js'\n\n\nif(Meteor.isServer) {\n\tMeteor.startup(() => {\n\t  \t// code to run on server at startup\n\t  \tconst client = new Twitter({\n\t\t  consumer_key: TWITTER_CONSUMER_KEY,\n\t\t  consumer_secret: TWITTER_CONSUMER_SECRET,\n\t\t  access_token_key: TWITTER_ACCESS_TOKEN_KEY,\n\t\t  access_token_secret: TWITTER_ACCESS_TOKEN_SECRET,\n\t\t});\n\n\t  \tapp = Express();\n\t\tapp.use( bodyParser.json() );       // to support JSON-encoded bodies\n\t\tapp.use(bodyParser.urlencoded({     // to support URL-encoded bodies\n\t\t  extended: true\n\t\t}));\n\n\t\t// TO TEST\n\t\t// const hastag = 'Usain Bolt'\n\t\t// const twitterStream = client.stream('statuses/filter', {track: String(hastag)});\n\t\t// let i = 0\n\t\t// twitterStream.on('data', function(tweet) {\n\t\t//   \t// Send a message to all connected sessions (Client & server)\n\t\t//   \tif (i%10 === 0) {\n\t\t//   \t\tconsole.log('tweet --> ', tweet.id_str)\n\t\t// \t\tStreamy.broadcast('hello', tweet);\t\n\t\t//   \t}\n\t\t// \ti++\n\t\t// });\n\t\t// -----\n\n\t\tconst timeCondition = function (lastDatetime, cbYes, cbNo) {\n\t\t\tvar last = new Date(lastDatetime)\n\t\t\tvar now = new Date()\n\t\t\tconsole.log(last, now)\n\t\t\tvar timeDiff = Math.abs(now.getTime() - last.getTime())\n\t\t\tvar diffSeconds = Math.ceil(timeDiff / (1000))\n\t\t\tconsole.log('diff in seconds: ', diffSeconds)\n\t\t\t// CHECK 15 MINUTES INTERVAL\n\t\t\tif (diffSeconds > 15*60) {\n\t\t\t\tconsole.log('more than 15 minutes: request twitter...')\n\t\t\t\tcbYes()\n\t\t\t} else {\n\t\t\t\tconsole.log('less than 15 minutes: send last saved woeid...')\n\t\t\t\tcbNo()\n\t\t\t}\n\t\t}\n\n\t\tapp.get('/trends/available', function(req, res) {\n\t\t\tconst woeid = Woeid.findOne({}, {sort: {datetime: -1, limit: 1}});\n\t\t\tlet datetime = 0\n\t\t\tif (woeid && woeid.datetime) datetime = woeid.datetime \n\t\t\ttimeCondition(\n\t\t\t\tdatetime,\n\t\t\t\tfunction() {\n\t\t\t\t\tclient.get('trends/available', function(error, tweets, response){\n\t\t\t\t\t\tif(error) throw error;\n\t\t\t\t\t\tif ( response ) {\n\t\t\t\t\t\t\t// INSERT IN DB\n\t\t\t\t\t\t\tFiber(function () {\n\t\t          \t\t\t\tWoeid.insert({\n\t\t          \t\t\t\t\tdatetime: new Date(),\n\t\t          \t\t\t\t\tbody: response.body\n\t\t          \t\t\t\t}, function (error, response) {\n\t\t          \t\t\t\t\tconsole.log(response)\n\t\t\t\t\t\t        \tconsole.log('new woeid in db ', Woeid.find().count())\n\t\t\t\t\t\t        })\n\t\t        \t\t\t}).run()\n\t\t\t\t\t\t\tres.json({data: response.body});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\t\n\t\t\t\t}, function() {\n\t\t\t\t\tres.json({data: woeid.body})\n\t\t\t\t}\n\t\t\t)\n\t\t});\n\t\t\n\t\tapp.post('/trends', function(req, res) {\n\t\t\tvar woeid = req.body.woeid\n\t\t\tif (woeid) {\n\t\t\t\tFiber(function () {\n\t\t\t\t\tconsole.log(woeid)\n\t\t\t\t\tconst trend = Trend.findOne({woeid: woeid}, {sort: {datetime: -1, limit: 1}});\n\t\t\t\t\tlet datetime = 0\n\t\t\t\t\tif (trend && trend.datetime) datetime = trend.datetime \n\t\t\t\t\ttimeCondition(\n\t\t\t\t\t\tdatetime,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tclient.get('trends/place', {id: woeid}, function(error, tweets, response){\n\t\t\t\t\t\t\t\tif(error) throw error;\n\t\t\t\t\t\t\t\tif ( response ) {\n\t\t\t\t\t\t\t\t\t// INSERT IN DB\n\t\t\t\t\t\t\t\t\tFiber(function () {\n\t\t\t\t          \t\t\t\tTrend.insert({\n\t\t\t\t          \t\t\t\t\twoeid: woeid,\n\t\t\t\t          \t\t\t\t\tdatetime: new Date(),\n\t\t\t\t          \t\t\t\t\tbody: response.body\n\t\t\t\t          \t\t\t\t}, function (error, response) {\n\t\t\t\t          \t\t\t\t\tconsole.log(response)\n\t\t\t\t\t\t\t\t        \tconsole.log('new trend in db ', Trend.find().count())\n\t\t\t\t\t\t\t\t        })\n\t\t\t\t        \t\t\t}).run()\n\t\t\t\t\t\t\t\t\tres.json({data: response.body});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\t\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\tres.json({data: woeid.body})\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t}).run()\t\n\t\t\t} else {\n\t\t\t\tres.json({data: 'error required a valid woeid'})\n\t\t\t}\n\t\t\t\n\t\t});\n\n\t\tapp.post('/tweets', function(req, res) {\n\t\t\tvar hastag = req.body.hastag\n\t\t    if (hastag) {\n\t\t    \tconsole.log(\"hastag: \", hastag)\n\t\t    \t// const hastag = 'Usain Bolt'\n\t\t\t\tconst twitterStream = client.stream('statuses/filter', {track: String(hastag)});\n\t\t\t\tlet i = 0\n\t\t\t\ttwitterStream.on('data', function(tweet) {\n\t\t\t\t  \t// Send a message to all connected sessions (Client & server)\n\t\t\t\t  \tif (i%10 === 0) {\n\t\t\t\t  \t\tconsole.log('tweet --> ', tweet.id_str)\n\t\t\t\t\t\tStreamy.broadcast('hello', tweet);\t\n\t\t\t\t  \t}\n\t\t\t\t\ti++\n\t\t\t\t});\n\t\t    }\n\t\t});\n\n  \t});\n}\n\n"]},"hash":"773ea18a792c8343cf12bfac4846481c5393f514"}
